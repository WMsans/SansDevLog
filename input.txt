哈喽大家好，我是闪衫。
今天，我们来做游戏。
前几天玩《大香蕉》玩得特别嗨，但总觉得不过瘾。
我就在想，要是能有一款像《我的世界》那样自由的沙盒游戏，
同时又拥有《大香蕉》那种精致的平滑画面，该多好？
不管了，我就是要做一个自己的游戏！
直接开搓！


做游戏嘛，能参考开源代码肯定要先参考。
而所有关于“平滑体素”的技术，都绕不开一个概念——SDF，也就是有向距离场。
什么是 SDF？
简单说，传统的体素像 MC，数值代表“有没有方块”；
而 SDF 的数值代表“距离物体表面有多远”。
有了这个，我们就可以用数学公式画出任何形状。
比如一个球体、一个甜甜圈，当然，还有大香蕉。
啊是这个大香蕉。
而且，用公式算出来的物体，表面是绝对平滑的，没有锯齿。
接下来是引擎选择。
这里我选 Unity，因为……Unity 是最强的游戏引擎。
为了追求绝对平滑，我没有使用传统的三角形近似，
而是直接对 SDF 进行光线追踪。
因为场景本质是一堆数学公式，判断光线是否击中物体非常容易。
最后，我们直接把光线行进了多远渲染出来，画面就有了。
额小问题，只需要用 10 年功力学习 Games101 系列，
并使用 Blinn-Phong 模型进行着色就行。


但是现在感觉有点太单调了，加点地形吧。
嗯……不怎么好看。
但我转念一想，可以求助于“古希腊掌管 SDF 的神”——噪声函数。
现在好多了。
但如果没有破坏，还叫什么体素引擎？
代码走起！
现在玩家可以直接在地形上进行编辑了。
不过，这个世界还是太小了。
想要更大的视距，就需要引入“区块”系统。
程序写完，直接加载……
呃，加载有点慢。
这时候就该引入 LoD 多细节层次了。
远处的区块简化处理，加载速度瞬间变快。
作为平滑体素，如果不能平滑编辑怎么行？
我实现了一个游戏对象，每帧更新周围的体素，
这就有了“体素球”。
玩家甚至能把它发射出去。


哦对，原来没有物理。
我直接使用 Marching Cubes 算法对 SDF 进行三角形近似，
配合 Unity 的 Mesh Collider，物理效果这就来了。
而且顺带还解决了一个远古难题——让树木不再漂浮。
有了树，顺带加个草吧。
草直接在每个体素上面渲染四个三角形就行，简单粗暴。
但现在出现了重大问题：
因为光线追踪计算量大，每条光线要走很久才能到达世界边缘，
帧率暴跌。
普通程序员这时该选择稀疏体素了，但我另辟蹊径——
直接将渲染分辨率降低。
因为光线追踪是一个像素一条光线，这样做能从根源减少计算量。
但这样太丑了怎么办？
我直接加上边缘检测和二游光影，
当然，这是受到了《A Short Hike》的启发。
最后，加上太阳光，再配上我自己制作的……“神曲”，
一个稍微比较完整的游戏就完成了。


当然，这个游戏目前还没有具体的玩法，
但源码已经 MIT 开源，链接在简介里。
也欢迎在评论区提出一些对玩法的建议！
如果本期视频点赞突破了 1000，
我将在评论区里选取一个建议，作为下期要做的游戏主题！
那我们下期视频再见，拜拜！
